# -*- coding: utf-8 -*-

IND = {
    'ai': 'a&I',
    'au': 'a&U',
    'dZ': 'd&Z',
    'oi': 'O&I',
    'tS': 't&S',
    ' ': '_',
    '"': "'",
    '*': '"',
    '?': '?',
    '@': '$',
    'E': 'e',
    'I': 'i',
    'J': 'n~',
    'N': 'nK',
    'S': 'S',
    'U': 'u',
    'a': 'a',
    'b': 'b',
    'd': 'd',
    'e': 'e',
    'f': 'f',
    'g': 'g',
    'h': 'h',
    'i': 'i',
    'j': 'j',
    'k': 'k',
    'l': 'l',
    'm': 'm',
    'n': 'n',
    'O': 'o',
    'o': 'o',
    'p': 'p',
    'r': 'r',
    's': 's',
    't': 't',
    'u': 'u',
    'w': 'w',
    'x': 'x',
    'z': 'z',
    '|': '.'
}

ESG = {
    'I@':'I&$',
    'OI':'O&I',
    'U@':'U&$',
    'aI':'a&I',
    'aU':'a&U',
    'dZ':'d&Z',
    'e@':'E&$',
    'tS':'t&S',
    '"':"'",
    '#':'_',
    '$':'.',
    '%':"'2",
    '*':'"',
    '3':'E0',
    '@':'$',
    'A':'A',
    'D':'D',
    'E':'E',
    'I':'I',
    'N':'nK',
    'O':'O',
    'S':'S',
    'T':'T',
    'U':'U',
    'V':'^',
    'Z':'Z',
    'b':'b',
    'c':'A+',
    'd':'d',
    'e':'e&I',
    'f':'f',
    'g':'g',
    'h':'h',
    'i':'i',
    'j':'j',
    'k':'k',
    'l':'l',
    'm':'m',
    'n':'n',
    'o':'o&U',
    'p':'p',
    'r':'R+',
    's':'s',
    't':'t',
    'u':'u',
    'v':'v',
    'w':'w',
    'z':'z',
    '{':'@',
    '|':'.',
    'e|r':'E.R+',
    '{|r':'E.R+',
    '@r':'E0R+',
    ' ':'_'
}

ENG = {
    'p':'p',
    'b':'b',
    't':'t',
    'd':'d',
    'k':'k',
    'x10':'k',
    'g':'g',
    'G10':'g',
    'tS':'t&S', 
    'dZ':'d&Z',
    'f':'f',
    'v':'v',
    'T':'T',
    'D':'D',
    's':'s',
    'z':'z',
    'S':'S',
    'Z':'Z',
    'h':'h',
    'm':'m',
    'n':'n',
    'N':'nK',
    'r':'R+',
    'l':'l',
    'w':'w',
    'j':'j',
    'I':'I',
    'e':'e',
    '{':'@',
    'Q':'A+',
    'V':'^',
    'U':'U',
    '@':'$',
    'i':'i', 
    'eI':'eI',
    'aI':'aI',
    'OI':'OI',
    'u':'u',
    '@U':'$U',
    'aU':'aU',
    '3':'E0',
    'A':'A',
    'a11':'a',
    'O ':'O',
    'I@':'I$',
    'e@':'e$',
    'U@':'U$',
    '"':"'",
    '%':"'2",
    '|':'.',
    ' ':'_',
    '=':'%)'
}

ARW = {
    """b""" : """b""",
    """t""" : """t""",
    """d""" : """d""",
    """k""" : """k""",
    """g""" : """g""",
    """q""" : """q""",
    """?""" : """?""",
    """t_?""" : """t%K""",
    """d_?""" : """d%K""",
    """D_?""" : """D%K""",
    """s_?""" : """s%K""",
    """f""" : """f""",
    """T""" : """T""",
    """D""" : """D""",
    """s""" : """s""",
    """z""" : """z""",
    """S""" : """S""",
    """x""" : """X""",
    """G""" : """R\\""",
    """X\\""" : """h-""",
    """?\\""" : """?\\""",
    """h""" : """h6""",
    """dZ""" : """dz~""",
    """l""" : """l""",
    """l_?""" : """l""",
    """r""" : """r6""",
    """w""" : """w""",
    """j""" : """j""",
    """m""" : """m""",
    """n""" : """n""",
    """a""" : """@""",
    """i""" : """i""",
    """u""" : """u""",
    """a:""" : """@:""",
    """i:""" : """i:""",
    """u:""" : """u:""",
    """e:""" : """e""",
    """o:""" : """O:""",
    """\"""" : """'""",
    """|""" : """.""",
    """ """ : """_""",
    """b|b""" : """.b:""",
    """t|t""" : """.t:""",
    """d|d""" : """.d:""",
    """k|k""" : """.k:""",
    """g|g""" : """.g:""",
    """f|f""" : """.f:""",
    """s|s""" : """.s:""",
    """S|S""" : """.S:""",
    """m|m""" : """.m:""",
    """n|n""" : """.n:""",
    """l|l""" : """.l:""",
    """l_?|l_?""" : """.l:""",
    """l|l_?""" : """.l:""",
    """j|j""" : """.j:""",
    """w|w""" : """.w:""",
    """z|z""" : """.z:""",
    """dZ|dZ""" : """.dz~:""",
    """d|dZ""" : """.dz~:""",
    """T|T""" : """.T:""",
    """X\\|X\\""" : """.h-:""",
    """x|x""" : """.X:""",
    """D|D""" : """.D:""",
    """s_?|s_?""" : """.s:%K""",
    """d_?|d_?""" : """.d:%K""",
    """t_?|t_?""" : """.t:%K""",
    """D_?|D_?""" : """.D:%K""",
    """s|s_?""" : """.s:%K""",
    """d|d_?""" : """.d:%K""",
    """t|t_?""" : """.t:%K""",
    """D|D_?""" : """.D:%K""",
    """?\\|?\\""" : """.?\\:""",
    """G|G""" : """.R\\:""",
    """q|q""" : """.q:""",
    """h|h""" : """.h6:""",
    """b|"b""" : """.'b:""",
    """t|"t""" : """.'t:""",
    """d|"d""" : """.'d:""",
    """k|"k""" : """.'k:""",
    """g|"g""" : """.'g:""",
    """f|"f""" : """.'f:""",
    """s|"s""" : """.'s:""",
    """S|"S""" : """.'S:""",
    """m|"m""" : """.'m:""",
    """n|"n""" : """.'n:""",
    """l|"l""" : """.'l:""",
    """l_?|"l_?""" : """.'l:""",
    """l|"l_?""" : """.'l:""",
    """j|"j""" : """.'j:""",
    """w|"w""" : """.'w:""",
    """z|"z""" : """.'z:""",
    """dZ|"dZ""" : """.'dz~:""",
    """d|"dZ""" : """.'dz~:""",
    """T|"T""" : """.'T:""",
    """X\\|"X\\""" : """.'h-:""",
    """x|"x""" : """.'X:""",
    """D|"D""" : """.'D:""",
    """s_?|"s_?""" : """.'s:%K""",
    """d_?|"d_?""" : """.'d:%K""",
    """t_?|"t_?""" : """.'t:%K""",
    """D_?|"D_?""" : """.'D:%K""",
    """s|"s_?""" : """.'s:%K""",
    """d|"d_?""" : """.'d:%K""",
    """t|"t_?""" : """.'t:%K""",
    """D|"D_?""" : """.'D:%K""",
    """?\\|"?\\""" : """.'?\\:""",
    """G|"G""" : """.'R\\:""",
    """q|"q""" : """.'q:""",
    """h|"h""" : """.'h6:""",
    """ax""" : """AX""",
    """xa""" : """XA""",
    """a:x""" : """A:X""",
    """xa:""" : """XA:""",
    """a|x""" : """A.X""",
    """x|a""" : """X.A""",
    """a:|x""" : """A:.X""",
    """x|a:""" : """X.A:""",
    """a|"x""" : """A.'X""",
    """x|"a""" : """X.'A""",
    """a:|"x""" : """A:.'X""",
    """x|"a:""" : """X.'A:""",
    """aG""" : """AR\\""",
    """Ga""" : """R\\A""",
    """a:G""" : """A:R\\""",
    """Ga:""" : """R\\A:""",
    """a|G""" : """A.R\\""",
    """G|a""" : """R\\.A""",
    """a:|G""" : """A:.R\\""",
    """G|a:""" : """R\\.A:""",
    """a|"G""" : """A.'R\\""",
    """G|"a""" : """R\\.'A""",
    """a:|"G""" : """A:.'R\\""",
    """G|"a:""" : """R\\.'A:""",
    """aq""" : """Aq""",
    """qa""" : """qA""",
    """a:q""" : """A:q""",
    """qa:""" : """qA:""",
    """a|q""" : """A.q""",
    """q|a""" : """q.A""",
    """a:|q""" : """A:.q""",
    """q|a:""" : """q.A:""",
    """a|"q""" : """A.'q""",
    """q|"a""" : """q.'A""",
    """a:|"q""" : """A:.'q""",
    """q|"a:""" : """q.'A:""",
    """ar""" : """Ar6""",
    """ra""" : """r6A""",
    """a:r""" : """A:r6""",
    """ra:""" : """r6A:""",
    """a|r""" : """A.r6""",
    """r|a""" : """r6.A""",
    """a:|r""" : """A:.r6""",
    """r|a:""" : """r6.A:""",
    """a|"r""" : """A.'r6""",
    """r|"a""" : """r6.'A""",
    """a:|"r""" : """A:.'r6""",
    """r|"a:""" : """r6.'A:""",
    """as_?""" : """As%K""",
    """s_?a""" : """s%KA""",
    """a:s_?""" : """A:s%K""",
    """s_?a:""" : """s%KA:""",
    """a|s_?""" : """A.s%K""",
    """s_?|a""" : """s%K.A""",
    """a:|s_?""" : """A:.s%K""",
    """s_?|a:""" : """s%K.A:""",
    """a|"s_?""" : """A.'s%K""",
    """s_?|"a""" : """s%K.'A""",
    """a:|"s_?""" : """A:.'s%K""",
    """s_?|"a:""" : """s%K.'A:""",
    """ad_?""" : """Ad%K""",
    """d_?a""" : """d%KA""",
    """a:d_?""" : """A:d%K""",
    """d_?a:""" : """d%KA:""",
    """a|d_?""" : """A.d%K""",
    """d_?|a""" : """d%K.A""",
    """a:|d_?""" : """A:.d%K""",
    """d_?|a:""" : """d%K.A:""",
    """a|"d_?""" : """A.'d%K""",
    """d_?|"a""" : """d%K.'A""",
    """a:|"d_?""" : """A:.'d%K""",
    """d_?|"a:""" : """d%K.'A:""",
    """at_?""" : """At%K""",
    """t_?a""" : """t%KA""",
    """a:t_?""" : """A:t%K""",
    """t_?a:""" : """t%KA:""",
    """a|t_?""" : """A.t%K""",
    """t_?|a""" : """t%K.A""",
    """a:|t_?""" : """A:.t%K""",
    """t_?|a:""" : """t%K.A:""",
    """a|"t_?""" : """A.'t%K""",
    """t_?|"a""" : """t%K.'A""",
    """a:|"t_?""" : """A:.'t%K""",
    """t_?|"a:""" : """t%K.'A:""",
    """aD_?""" : """AD%K""",
    """D_?a""" : """D%KA""",
    """a:D_?""" : """A:D%K""",
    """D_?a:""" : """D%KA:""",
    """a|D_?""" : """A.D%K""",
    """D_?|a""" : """D%K.A""",
    """a:|D_?""" : """A:.D%K""",
    """D_?|a:""" : """D%K.A:""",
    """a|"D_?""" : """A.'D%K""",
    """D_?|"a""" : """D%K.'A""",
    """a:|"D_?""" : """A:.'D%K""",
    """D_?|"a:""" : """D%K.'A:""",
    """ax|x""" : """A.X:""",
    """x|xa""" : """.X:A""",
    """a:x|x""" : """A:.X:""",
    """x|xa:""" : """.X:A:""",
    """ax|"x""" : """A.'X:""",
    """x|"xa""" : """.'X:A""",
    """a:x|"x""" : """A:.'X:""",
    """x|"xa:""" : """.'X:A:""",
    """aG|G""" : """A.R\\:""",
    """G|Ga""" : """.R\\:A""",
    """a:G|G""" : """A:.R\\:""",
    """G|Ga:""" : """.R\\:A:""",
    """aG|"G""" : """A.'R\\:""",
    """G|"Ga""" : """.'R\\:A""",
    """a:G|"G""" : """A:.'R\\:""",
    """G|"Ga:""" : """.'R\\:A:""",
    """aq|q""" : """A.q:""",
    """q|qa""" : """.q:A""",
    """a:q|q""" : """A:.q:""",
    """q|qa:""" : """.q:A:""",
    """aq|"q""" : """A.'q:""",
    """qq|"a""" : """.'q:A""",
    """a:q|"q""" : """A:.'q:""",
    """q|"qa:""" : """.'q:A:""",
    """as_?|s_?""" : """A.s:%K""",
    """as|s_?""" : """A.s:%K""",
    """s_?|s_?a""" : """.s:%KA""",
    """s|s_?a""" : """.s:%KA""",
    """a:s_?|s_?""" : """A:.s:%K""",
    """a:s|s_?""" : """A:.s:%K""",
    """s_?|s_?a:""" : """.s:%KA:""",
    """s|s_?a:""" : """.s:%KA:""",
    """as_?|"s_?""" : """A.'s:%K""",
    """as|"s_?""" : """A.'s:%K""",
    """s_?|"s_?a""" : """.'s:%KA""",
    """s|"s_?a""" : """.'s:%KA""",
    """a:s_?|"s_?""" : """A:.'s:%K""",
    """a:s|"s_?""" : """A:.'s:%K""",
    """s_?|"s_?a:""" : """.'s:%KA:""",
    """s|"s_?a:""" : """.'s:%KA:""",
    """ad_?|d_?""" : """A.d:%K""",
    """ad|d_?""" : """A.d:%K""",
    """d_?|d_?a""" : """.d:%KA""",
    """d|d_?a""" : """.d:%KA""",
    """a:d_?|d_?""" : """A:.d:%K""",
    """a:d|d_?""" : """A:.d:%K""",
    """d_?|d_?a:""" : """.d:%KA:""",
    """d|d_?a:""" : """.d:%KA:""",
    """ad_?|"d_?""" : """A.'d:%K""",
    """ad|"d_?""" : """A.'d:%K""",
    """d_?|"d_?a""" : """.'d:%KA""",
    """d|"d_?a""" : """.'d:%KA""",
    """a:d_?|"d_?""" : """A:.'d:%K""",
    """a:d|"d_?""" : """A:.'d:%K""",
    """d_?|"d_?a:""" : """.'d:%KA:""",
    """d|"d_?a:""" : """.'d:%KA:""",
    """at_?|t_?""" : """A.t:%K""",
    """at|t_?""" : """A.t:%K""",
    """t_?|t_?a""" : """.t:%KA""",
    """t|t_?a""" : """.t:%KA""",
    """a:t_?|t_?""" : """A:.t:%K""",
    """a:t|t_?""" : """A:.t:%K""",
    """t_?|t_?a:""" : """.t:%KA:""",
    """t|t_?a:""" : """.t:%KA:""",
    """at_?|"t_?""" : """A.'t:%K""",
    """at|"t_?""" : """A.'t:%K""",
    """t_?|"t_?a""" : """.'t:%KA""",
    """t|"t_?a""" : """.'t:%KA""",
    """a:t_?|"t_?""" : """A:.'t:%K""",
    """a:t|"t_?""" : """A:.'t:%K""",
    """t_?|"t_?a:""" : """.'t:%KA:""",
    """t|"t_?a:""" : """.'t:%KA:""",
    """aD_?|D_?""" : """A.D:%K""",
    """aD|D_?""" : """A.D:%K""",
    """D_?|D_?a""" : """.D:%KA""",
    """D|D_?a""" : """.D:%KA""",
    """a:D_?|D_?""" : """A:.D:%K""",
    """a:D|D_?""" : """A:.D:%K""",
    """D_?|D_?a:""" : """.D:%KA:""",
    """D|D_?a:""" : """.D:%KA:""",
    """aD_?|"D_?""" : """A.'D:%K""",
    """aD|"D_?""" : """A.'D:%K""",
    """D_?|"D_?a""" : """.'D:%KA""",
    """D|"D_?a""" : """.'D:%KA""",
    """a:D_?|"D_?""" : """A:.'D:%K""",
    """a:D|"D_?""" : """A:.'D:%K""",
    """D_?|"D_?a:""" : """.'D:%KA:""",
    """D|"D_?a:""" : """.'D:%KA:""",
    """a|xi""" : """@.Xi""",
    """a:|xi""" : """@:.Xi""",
    """a|"xi""" : """@.'Xi""",
    """a:|"xi""" : """@:.'Xi""",
    """a|xi:""" : """@.Xi:""",
    """a:|xi:""" : """@:.Xi:""",
    """a|"xi:""" : """@.'Xi:""",
    """a:|"xi:""" : """@:.'Xi:""",
    """a|xu""" : """@.Xu""",
    """a:|xu""" : """@:.Xu""",
    """a|"xu""" : """@.'Xu""",
    """a:|"xu""" : """@:.'Xu""",
    """a|xu:""" : """@.Xu:""",
    """a:|xu:""" : """@:.Xu:""",
    """a|"xu:""" : """@.'Xu:""",
    """a:|"xu:""" : """@:.'Xu:""",
    """a|ri""" : """@.r6i""",
    """a:|ri""" : """@:.r6i""",
    """a|"ri""" : """@.'r6i""",
    """a:|"ri""" : """@:.'r6i""",
    """a|ri:""" : """@.r6i:""",
    """a:|ri:""" : """@:.r6i:""",
    """a|"ri:""" : """@.'r6i:""",
    """a:|"ri:""" : """@:.'r6i:""",
    """a|ru""" : """@.r6u""",
    """a:|ru""" : """@:.r6u""",
    """a|"ru""" : """@.'r6u""",
    """a:|"ru""" : """@:.'r6u""",
    """a|ru:""" : """@.r6u:""",
    """a:|ru:""" : """@:.r6u:""",
    """a|"ru:""" : """@.'r6u:""",
    """a:|"ru:""" : """@:.'r6u:""",
    """a|Gi""" : """@.R\\i""",
    """a:|Gi""" : """@:.R\\i""",
    """a|"Gi""" : """@.'R\\i""",
    """a:|"Gi""" : """@:.'R\\i""",
    """a|Gi:""" : """@.R\\i:""",
    """a:|Gi:""" : """@:.R\\i:""",
    """a|"Gi:""" : """@.'R\\i:""",
    """a:|"Gi:""" : """@:.'R\\i:""",
    """a|Gu""" : """@.R\\u""",
    """a:|Gu""" : """@:.R\\u""",
    """a|"Gu""" : """@.'R\\u""",
    """a:|"Gu""" : """@:.'R\\u""",
    """a|Gu:""" : """@.R\\u:""",
    """a:|Gu:""" : """@:.R\\u:""",
    """a|"Gu:""" : """@.'R\\u:""",
    """a:|"Gu:""" : """@:.'R\\u:""",
    """a|qi""" : """@.qi""",
    """a:|qi""" : """@:.qi""",
    """a|"qi""" : """@.'qi""",
    """a:|"qi""" : """@:.'qi""",
    """a|qi:""" : """@.qi:""",
    """a:|qi:""" : """@:.qi:""",
    """a|"qi:""" : """@.'qi:""",
    """a:|"qi:""" : """@:.'qi:""",
    """a|qu""" : """@.qu""",
    """a:|qu""" : """@:.qu""",
    """a|"qu""" : """@.'qu""",
    """a:|"qu""" : """@:.'qu""",
    """a|qu:""" : """@.qu:""",
    """a:|qu:""" : """@:.qu:""",
    """a|"qu:""" : """@.'qu:""",
    """a:|"qu:""" : """@:.'qu:""",
    """ax|xi""" : """@.X:i""",
    """a:x|xi""" : """@:.X:i""",
    """ax|"xi""" : """@.'X:i""",
    """a:x|"xi""" : """@:.'X:i""",
    """ax|xi:""" : """@.X:i:""",
    """a:x|xi:""" : """@:.X:i:""",
    """ax|"xi:""" : """@.'X:i:""",
    """a:x|"xi:""" : """@:.'X:i:""",
    """ax|xu""" : """@.X:u""",
    """a:x|xu""" : """@:.X:u""",
    """ax|"xu""" : """@.'X:u""",
    """a:x|"xu""" : """@:.'X:u""",
    """ax|xu:""" : """@.X:u:""",
    """a:x|xu:""" : """@:.X:u:""",
    """ax|"xu:""" : """@.'X:u:""",
    """a:x|"xu:""" : """@:.'X:u:""",
    """aG|Gi""" : """@.R\\:i""",
    """a:G|Gi""" : """@:.R\\:i""",
    """aG|"Gi""" : """@.'R\\:i""",
    """a:G|"Gi""" : """@:.'R\\:i""",
    """aG|Gi:""" : """@.R\\:i:""",
    """a:G|Gi:""" : """@:.R\\:i:""",
    """aG|"Gi:""" : """@.'R\\:i:""",
    """a:G|"Gi:""" : """@:.'R\\:i:""",
    """aG|Gu""" : """@.R\\:u""",
    """a:G|Gu""" : """@:.R\\:u""",
    """aG|"Gu""" : """@.'R\\:u""",
    """a:G|"Gu""" : """@:.'R\\:u""",
    """aG|Gu:""" : """@.R\\:u:""",
    """a:G|Gu:""" : """@:.R\\:u:""",
    """aG|"Gu:""" : """@.'R\\:u:""",
    """a:G|"Gu:""" : """@:.'R\\:u:""",
    """aq|qi""" : """@.q:i""",
    """a:q|qi""" : """@:.q:i""",
    """aq|"qi""" : """@.'q:i""",
    """a:q|"qi""" : """@:.'q:i""",
    """aq|qi:""" : """@.q:i:""",
    """a:q|qi:""" : """@:.q:i:""",
    """aq|"qi:""" : """@.'q:i:""",
    """a:q|"qi:""" : """@:.'q:i:""",
    """aq|qu""" : """@.q:u""",
    """a:q|qu""" : """@:.q:u""",
    """aq|"qu""" : """@.'q:u""",
    """a:q|"qu""" : """@:.'q:u""",
    """aq|qu:""" : """@.q:u:""",
    """a:q|qu:""" : """@:.q:u:""",
    """aq|"qu:""" : """@.'q:u:""",
    """a:q|"qu:""" : """@:.'q:u:""",
    """N""" : """nK""",
    """'""":"""'""",
    """t:""":"""t:"""
}

PHONES = {'IND': IND, 'SEN': ESG, 'GFA': ARW}
PHONES_maxlen = {'IND': 2, 'SEN': 3, 'GFA': 10}

def nt_sampa_2_lh_plus(language, ntsamp_phoneme):
    """
    'language': IND, ESG. Other will be raise exception 'ValueError'
    'ntsamp_phoneme': the NT-Sampa phoneme string

    @ret: L&H+ phoneme string
    """
    phones = PHONES.get(language)
    maxlen = PHONES_maxlen.get(language)
    if not phones:
        return ntsamp_phoneme

    len_of_phoneme = len(ntsamp_phoneme)
    if len_of_phoneme == 0:
        raise ValueError('ntsamp_phoneme is EMPTY')

    i = 0
    lhphone = ''
    while i < len_of_phoneme:
        #print ntsamp_phoneme[:i]
        for match_len in range(maxlen, 0, -1):
            if (i + match_len) > len_of_phoneme:
                continue
            
            match_char = ntsamp_phoneme[i : i + match_len]
            
            #
            if '*' == match_char and '"' != ntsamp_phoneme[i + 1]:
                raise ValueError('The nuclear stress(*), if present must immediately precede a primary stress(") symbol.')
            
            if phones.has_key(match_char):
                lhphone += phones[match_char]
                i += match_len
                break
        else:
            raise ValueError('fail to process phoneme: %s\t%s' % (language,ntsamp_phoneme))

    return lhphone

if __name__ == '__main__':
    #print nt_sampa_2_lh_plus('GFA','"?aw|si: "li:|dZindz "fun|duq "ri:d|dZiz "bla:|za:')
    print nt_sampa_2_lh_plus('GFA',r'"Sa:|ri?\ ?ar|"raw|D_?at:')
    print nt_sampa_2_lh_plus('CZE',r'"t_se|sto|vJi: "kan|t_se|la:Q\\')
    